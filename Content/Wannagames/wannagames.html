<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WanaGames CTF WriteUp</title>
    <link rel="stylesheet" href="../universalmd.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
        <span class="toggle-icon">ðŸŒ™</span>
    </button>

    <aside class="toc-sidebar" id="tocSidebar">
        <h3>Contents</h3>
        <nav id="tocNav"></nav>
    </aside>

    <main class="markdown-content" id="content"></main>

    <footer class="site-footer">
        <div class="footer-inner">
            <a href="https://github.com/Nikmfaris" class="footer-link" target="_blank" rel="noopener noreferrer">
                
                <span class="footer-text">&copy; 2025 CTF WriteUps by kudegulong.</span>
                
            </a>
        </div>
    </footer>

      

    <script>
        // Theme Toggle Functionality
        const themeToggle = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;
        const toggleIcon = document.querySelector('.toggle-icon');

        // Initialize theme on page load
        function initializeTheme() {
            // Check localStorage first, then system preference, then default to light
            let theme = localStorage.getItem('theme');
            
            if (!theme) {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                theme = prefersDark ? 'dark' : 'light';
            }
            
            applyTheme(theme);
        }

        // Apply theme to HTML element and update icon
        function applyTheme(theme) {
            htmlElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            updateToggleIcon(theme);
        }

        // Update toggle button icon based on theme
        function updateToggleIcon(theme) {
            toggleIcon.textContent = theme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
        }

        // Theme toggle click handler
        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        });

        // Initialize on page load
        initializeTheme();

        // Load and parse markdown
        fetch('wannagames.md')
            .then(response => response.text())
            .then(markdown => {
                document.getElementById('content').innerHTML = marked.parse(markdown);
                generateTableOfContents();
            })
            .catch(error => {
                document.getElementById('content').innerHTML = '<p style="color: red;">Error loading markdown file: ' + error + '</p>';
            });

        // Generate table of contents from h2 headings
        function generateTableOfContents() {
            const content = document.getElementById('content');
            const tocNav = document.getElementById('tocNav');
            const headings = content.querySelectorAll('h2');
            
            headings.forEach((heading, index) => {
                // Create ID for heading if it doesn't have one
                if (!heading.id) {
                    heading.id = `challenge-${index}`;
                }
                
                // Extract just the challenge name (remove emoji)
                let challengeName = heading.textContent.trim();
                challengeName = challengeName.replace(/^ðŸ”\s*/, '');
                
                // Create TOC link
                const link = document.createElement('a');
                link.href = `#${heading.id}`;
                link.textContent = challengeName;
                link.className = 'toc-link';
                
                // Smooth scroll on click
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
                
                tocNav.appendChild(link);
            });
        }
    </script>
</body>
</html>